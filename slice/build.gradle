apply plugin: 'java'
apply plugin: "com.google.protobuf"
apply plugin: 'idea'

def grpcVersion = '1.15.0'
def protoVersion = '3.6.1'

protobuf {
    protoc {
        artifact = "com.google.protobuf:protoc:${protoVersion}"
    }
    plugins {
        grpc {
            artifact = "io.grpc:protoc-gen-grpc-java:${grpcVersion}"
        }
    }
    generateProtoTasks {
        all()*.plugins {
            grpc {
                outputSubDir = "java"
            }
        }
    }

    generatedFilesBaseDir = "$projectDir/src"
}

sourceSets {
    main {
        proto {
            srcDir 'src/main/proto'
            include '**/*.proto'
        }
    }
}


dependencies {
    implementation(
            "com.google.protobuf:protobuf-java:${protoVersion}",
    )
    implementation group: 'io.netty', name: 'netty-all', version: '4.1.28.Final'

    implementation "com.google.api.grpc:proto-google-common-protos:1.12.0"
    implementation "io.grpc:grpc-alts:${grpcVersion}"
    implementation "io.grpc:grpc-netty:${grpcVersion}"
    implementation "io.grpc:grpc-protobuf:${grpcVersion}"
    implementation "io.grpc:grpc-stub:${grpcVersion}"

    testImplementation "io.grpc:grpc-testing:${grpcVersion}"
}


buildscript {
    repositories {
        maven {
            url "https://maven.aliyun.com/nexus/content/groups/public/"
        }
    }
    dependencies {
        classpath 'com.google.protobuf:protobuf-gradle-plugin:0.8.13'
    }
}
